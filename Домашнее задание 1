# задание 1
import json

purchases = {}

with open('C:/Users/barin/Desktop/Учёба/Python for data engineering/Python для инженерии данных/01._Работа_с_файлами_и_пакетами/purchase_log.txt', "r", encoding="utf-8") as f:
    # ваш код
    for line in f:
        if line.strip():
            data = json.loads(line)
            purchases[data["user_id"]] = data["category"]

# проверка
for i, (user_id, category) in enumerate(list(purchases.items())[:3]):
    print(f"{user_id} '{category}'")


# задание 2
with open('C:/Users/barin/Desktop/Учёба/Python for data engineering/Python для инженерии данных/01._Работа_с_файлами_и_пакетами/visit_log.csv', "r", encoding="utf-8") as f:
    with open('funnel.csv', 'w', encoding="utf-8") as f2write:
        for line in f:
            # разбиваем строку CSV
            data = line.strip().split(',')
        
            user_id = data[0]
            source = data[1]
        
            # проверяем была ли покупка (user_id в словаре purchases)
            if user_id in purchases:
                category = purchases[user_id]

                # добавление столбца с категорией покупки
                new_line = f"{user_id},{source},{category}\n"
                
                # запись в funnel.csv
                f2write.write(new_line)

                print({user_id}, {source}, {category})

# проверка
f1 = open("funnel.csv", "r", encoding="utf-8") 
    
content = f1.readlines()
content[:5]
